name: Xclipse 940 Wrapper Build & Feature Dump

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  build-wrapper:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Install Dependencies
      run: |
        sudo apt update
        sudo apt install -y cmake ninja-build clang pkg-config

    - name: Configure Build
      run: |
        mkdir -p build
        cd build
        cmake -G Ninja -DCMAKE_BUILD_TYPE=Release ..

    - name: Build Wrapper
      run: |
        cd build
        ninja

    - name: Collect Outputs
      run: |
        mkdir -p output_bundle
        cp build/libxeno_wrapper.so output_bundle/ || true
        cp build/xclipse_feature_dump_generator output_bundle/ || true
        cp feature_dump.txt output_bundle/ || true
        cp manifest.json output_bundle/ || true
        zip -r xclipse_output_bundle.zip output_bundle

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: xclipse-build
        path: xclipse_output_bundle.zip
