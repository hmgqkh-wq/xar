name: build

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Android NDK r25b
        uses: nttld/setup-ndk@v1
        with:
          ndk-version: r25b
          local-cache: true

      - name: Configure Build (CMake)
        run: |
          cmake -B build \
            -DANDROID_ABI=arm64-v8a \
            -DANDROID_PLATFORM=android-29 \
            -DANDROID_NDK=$ANDROID_NDK_HOME \
            -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK_HOME/build/cmake/android.toolchain.cmake

      - name: Build
        run: cmake --build build --config Release

      - name: Run feature dump generator (best-effort)
        continue-on-error: true
        run: |
          if [ -f build/feature_dump_generator ]; then
            ./build/feature_dump_generator > feature_dump.txt
          fi

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: xclipse_wrapper
          path: |
            build/*.so
            feature_dump.txt
