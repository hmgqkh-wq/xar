name: Xclipse 940 Vulkan Wrapper Build

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    # Install latest NDK (r27)
    - name: Install NDK
      uses: nttld/setup-ndk@v1
      with:
        ndk-version: r27

    # Configure CMake with NDK toolchain
    - name: Configure CMake
      run: |
        cmake -S . -B build \
          -DANDROID_ABI=arm64-v8a \
          -DANDROID_PLATFORM=android-23 \
          -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK_HOME/build/cmake/android.toolchain.cmake \
          -DCMAKE_BUILD_TYPE=Release

    # Build Vulkan wrapper
    - name: Build Project
      run: |
        cmake --build build --parallel

    # Collect output - FIXED NAME: liblibxeno_wrapper.so
    - name: Collect Wrapper Output
      run: |
        mkdir -p output_bundle/lib/arm64-v8a
        cp build/liblibxeno_wrapper.so output_bundle/lib/arm64-v8a/libvulkan.xeno_wrapper.so
        cp manifest.json output_bundle/

        cd output_bundle
        zip -r ../xclipse_wrapper.zip .

    # Upload wrapper artifact
    - name: Upload Wrapper Artifact
      uses: actions/upload-artifact@v4
      with:
        name: xclipse-vulkan-wrapper
        path: xclipse_wrapper.zip
